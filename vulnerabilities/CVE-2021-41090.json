{
	"id": "CVE-2021-41090",
	"description": "Grafana Agent is a telemetry collector for sending metrics, logs, and trace data to the opinionated Grafana observability stack. Prior to versions 0.20.1 and 0.21.2, inline secrets defined within a metrics instance config are exposed in plaintext over two endpoints: metrics instance configs defined in the base YAML file are exposed at `/-/config` and metrics instance configs defined for the scraping service are exposed at `/agent/api/v1/configs/:key`. Inline secrets will be exposed to anyone being able to reach these endpoints. If HTTPS with client authentication is not configured, these endpoints are accessible to unauthenticated users. Secrets found in these sections are used for delivering metrics to a Prometheus Remote Write system, authenticating against a system for discovering Prometheus targets, and authenticating against a system for collecting metrics. This does not apply for non-inlined secrets, such as `*_file` based secrets. This issue is patched in Grafana Agent versions 0.20.1 and 0.21.2. A few workarounds are available. Users who cannot upgrade should use non-inline secrets where possible. Users may also desire to restrict API access to Grafana Agent with some combination of restricting the network interfaces Grafana Agent listens on through `http_listen_address` in the `server` block, configuring Grafana Agent to use HTTPS with client authentication, and/or using firewall rules to restrict external access to Grafana Agent's API.\n\nA security issue has been found in Grafana Agent before version 0.21.2. Some inline secrets are exposed in plaintext over the Grafana Agent HTTP server:\r\n\r\n- Inline secrets for metrics instance configs in the base YAML file are exposed at /-/config\r\n- Inline secrets for integrations are exposed at /-/config\r\n- Inline secrets for Consul ACL tokens and ETCD basic auth when configured for the scraping service at /-/config.\r\n- Inline secrets for the Kafka receiver for OpenTelemetry-Collector tracing at /-/config.\r\n- Inline secrets for metrics instance configs loaded from the scraping service are exposed at /agent/api/v1/configs/{name}.\r\n\r\nInline secrets will be exposed to anyone being able to reach these endpoints.\r\n\r\nSecrets found in these sections are used for:\r\n\r\n- Delivering metrics to a Prometheus Remote Write system\r\n- Authenticating against a system for discovering Prometheus targets\r\n- Authenticating against a system for collecting metrics (scrape_configs and integrations)\r\n- Authenticating against a Consul or ETCD for storing configurations to distribute in scraping service mode\r\n- Authenticating against Kafka for receiving traces\r\n\r\nNon-inlined secrets, such as *_file-based secrets, are not impacted by this vulnerability.",
	"hardware": [],
	"software": [
		{
			"vendor": "archlinux",
			"product": "grafana-agent",
			"version": "< 0.21.2-1"
		}
	],
	"references": [
		"https://github.com/grafana/agent/security/advisories/GHSA-9c4x-5hgq-q3wh",
		"https://github.com/grafana/agent/pull/1152",
		"https://github.com/grafana/agent/commit/af7fb01e31fe2d389e5f1c36b399ddc46b412b21",
		"https://github.com/grafana/agent/releases/tag/v0.20.1",
		"https://github.com/grafana/agent/releases/tag/v0.21.2",
		"https://security.netapp.com/advisory/ntap-20211229-0004/"
	],
	"_edited_": false,
	"severity": "High"
}